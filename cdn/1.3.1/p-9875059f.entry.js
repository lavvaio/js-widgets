import{r as s,h as t}from"./p-878bd889.js";import{S as i,f as o,C as a}from"./p-189a6ab1.js";import{s as h}from"./p-1c3cb269.js";import{a as e}from"./p-b0f56eea.js";let n=class{constructor(t){s(this,t),this.dataKey=void 0,this.namespace="yahoo-quotes",this.useCache=!0,this.symbols=new Map,this.data=[],this.debug=!1,this.logger=e("yahoo-quotes"),this.subscriptions=new i}async log(...s){this.debug&&this.logger.log(...s)}connectedCallback(){if(this.loadQuotes(),!this.connection)throw new Error("connection was not found");this.subscriptions.add(this.connection.channelStream(this.channel).pipe(o((s=>s.type===a.CLIENT_CONNECTED))).subscribe((s=>{this.log("client connected",s.value.client_id)}))),this.subscriptions.add(this.connection.channelStream(this.channel).pipe(o((s=>s.type===a.DATA)),o((s=>void 0===this.dataKey||s.key===this.dataKey))).subscribe((s=>{this.saveQuote(s.value)})))}saveQuote(s){this.symbols.set(s.symbol,s),this.data=Array.from(this.symbols,(([s,t])=>({name:s,value:t}))),this.useCache&&h.namespace(this.namespace).set(this.channel,this.data)}loadQuotes(){if(this.useCache){const s=h.namespace(this.namespace);this.data=s.get(this.channel,this.data),this.symbols=new Map((this.data||[]).map((s=>[s.name,s.value])))}}disconnectedCallback(){this.subscriptions.unsubscribe()}render(){return t("div",null,t("div",{class:"yquotes"},this.data.map((s=>t("yahoo-quote",{class:s.name,data:s.value})))),t("div",{class:"powered-by"},"Powered by Yahoo quotes"))}};n.style='.powered-by{font-size:9px;font-family:"monospace";opacity:0.5;padding:2px 0}.yquotes{display:flex;background:#123962;color:#fff;padding:30px;overflow:hidden;position:relative;transform:translate3d(0, 0, 0)}';export{n as yahoo_quotes}